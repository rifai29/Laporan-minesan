<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Laporan Kasir v1.0.4</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --alfamidi-red: #e1211a; --alfamidi-yellow: #ffcf00; --off-white: #f8f8f8; --text-main: #1e293b; --text-muted: #64748b; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        body { background-color: var(--off-white); color: var(--text-main); }

        /* Layout Dasar */
        .navbar { background-color: var(--alfamidi-red); color: white; padding: 15px 20px; display: flex; align-items: center; position: sticky; top: 0; z-index: 1000; }
        .menu-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; margin-right: 20px; }
        .nav-title { font-weight: 700; font-size: 1.1rem; }

        /* Sidebar */
        .sidebar { position: fixed; left: -280px; top: 0; height: 100%; width: 280px; background: white; transition: 0.3s ease; z-index: 1100; padding: 30px 20px; border-right: 4px solid var(--alfamidi-yellow); }
        .sidebar.active { left: 0; }
        .sidebar-link { display: block; padding: 15px 0; color: var(--text-main); text-decoration: none; font-weight: 600; border-bottom: 1px solid #f1f5f9; cursor: pointer; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; z-index: 1050; }
        .overlay.active { display: block; }

        /* Content */
        .container { padding: 20px; max-width: 480px; margin: auto; }
        .card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; border-top: 3px solid var(--alfamidi-yellow); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .page { display: none; }
        .active-page { display: block; }

        /* Form */
        label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem; margin-bottom: 15px; outline: none; }
        .helper-text { font-size: 0.9rem; font-weight: 700; color: #059669; margin-bottom: 15px; }

        /* Buttons */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 700; cursor: pointer; margin-bottom: 10px; display: block; text-align: center; text-decoration: none; }
        .btn-red { background: var(--alfamidi-red); color: white; }
        .btn-outline { background: white; border: 2px solid var(--alfamidi-red); color: var(--alfamidi-red); }
        .btn-green { background: #1d6f42; color: white; }

        /* Table Bulanan */
        .month-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .month-box { background: white; padding: 15px; border-radius: 10px; text-align: center; border-bottom: 3px solid var(--alfamidi-yellow); }
    </style>
</head>
<body>

    <nav class="navbar">
        <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
        <div class="nav-title" id="header-title">INPUT DATA</div>
    </nav>

    <div class="sidebar" id="sidebar">
        <h2>Navigasi</h2>
        <div class="sidebar-link" onclick="showPage('harian', 'INPUT DATA')">Beranda</div>
        <div class="sidebar-link" onclick="showPage('bulanan', 'LAPORAN BULANAN')">Laporan Bulanan</div>
        <div class="sidebar-link" onclick="showPage('ekspor', 'EKSPOR & BACKUP')">Ekspor ke Excel</div>
        <div class="sidebar-link" onclick="resetData()" style="color: var(--alfamidi-red); margin-top: 40px;">Reset Data</div>
    </div>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="container">
        
        <div id="page-harian" class="page active-page">
            <div class="card">
                <label>Tanggal</label>
                <input type="date" id="tgl">
                <label>Jumlah Minus</label>
                <input type="number" id="minus" placeholder="0" oninput="updateHelper()">
                <div id="helper" class="helper-text">Terbaca: Rp 0</div>
                <button class="btn btn-red" onclick="simpan()">SIMPAN DATA</button>
            </div>
            <div style="text-align:center; font-size: 11px; color:#999">Versi Sistem v1.0.4</div>
        </div>

        <div id="page-bulanan" class="page">
            <div class="month-grid" id="grid-bulanan"></div>
        </div>

        <div id="page-ekspor" class="page">
            <div class="card">
                <h3>Ekspor Spreadsheet</h3>
                <p style="font-size: 12px; color:#666; margin-bottom: 15px;">Pilih metode jika download file eror di HP Anda.</p>
                
                <button class="btn btn-green" onclick="exportCSV()">ðŸ“¥ Download File .CSV</button>
                <button class="btn btn-outline" onclick="salinFormatExcel()">ðŸ“‹ Salin Teks (Untuk Paste ke Excel)</button>
            </div>
        </div>

    </div>

    <script>
        const DB_KEY = 'kasir_alfamidi_final';
        document.getElementById('tgl').valueAsDate = new Date();

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function showPage(id, title) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById('page-' + id).classList.add('active-page');
            document.getElementById('header-title').innerText = title;
            if(id === 'bulanan') renderBulanan();
            toggleMenu();
        }

        function updateHelper() {
            const val = document.getElementById('minus').value;
            document.getElementById('helper').innerText = "Terbaca: Rp " + (parseInt(val) || 0).toLocaleString('id-ID');
        }

        function simpan() {
            const tgl = document.getElementById('tgl').value;
            const amt = document.getElementById('minus').value;
            if(!amt) return alert("Isi angka dulu");

            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            data.unshift({ tgl, amt: parseInt(amt) });
            localStorage.setItem(DB_KEY, JSON.stringify(data));
            
            document.getElementById('minus').value = "";
            updateHelper();
            alert("Berhasil Disimpan!");
        }

        function renderBulanan() {
            const container = document.getElementById('grid-bulanan');
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            const rekap = {};
            data.forEach(item => {
                const m = new Date(item.tgl).toLocaleString('id-ID', { month: 'long', year: 'numeric' });
                rekap[m] = (rekap[m] || 0) + item.amt;
            });
            container.innerHTML = "";
            for (const [bulan, total] of Object.entries(rekap)) {
                container.innerHTML += `<div class="month-box"><div style="font-size:11px">${bulan}</div><div style="font-weight:700; color:var(--alfamidi-red)">Rp ${total.toLocaleString()}</div></div>`;
            }
        }

        // PERBAIKAN FITUR EKSPOR
        function exportCSV() {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            if(data.length === 0) return alert("Tidak ada data");

            let csvContent = "Tanggal,Jumlah\n";
            data.forEach(item => { csvContent += `${item.tgl},${item.amt}\n`; });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "laporan_kasir.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function salinFormatExcel() {
            const data = JSON.parse(localStorage.getItem(DB_KEY)) || [];
            if(data.length === 0) return alert("Data kosong");

            let teks = "Tanggal\tJumlah\n"; // Menggunakan TAB agar rapi saat di-paste ke Excel/Sheets
            data.forEach(item => { teks += `${item.tgl}\t${item.amt}\n`; });

            navigator.clipboard.writeText(teks).then(() => {
                alert("Teks berhasil disalin! Sekarang buka Google Sheets/Excel dan pilih 'Tempel' (Paste).");
            });
        }

        function resetData() {
            if(confirm("Hapus semua data?")) { localStorage.removeItem(DB_KEY); location.reload(); }
        }
    </script>
</body>
</html>
